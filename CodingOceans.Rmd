---
title: "Marine Protected Area Activity"
output: html_notebook
---

The U.S. has established nearly 1,000 Marine Protected Areas to protect important places in our ocean, estuaries, coastal waters, and Great Lakes. Marine Protected Areas strive to combat climate change, conserve cultural heritage, and protect marine organisms. 

Marine protected areas allow for ecological connectivity, and serve as protected "stepping stones" for marine organisms. Let's make a map so that we can see all of these stepping stones off of the Coast of California.

First, we'll need to load in some data that has information on all of the Marine Protected Areas in the United States. The data is in the form of a "shape file". We will load this file and call it "DataBase". 

```{r}
#install and load the "sf" package to read in the databse
install.packages("sf")
library("sf")

# loading our database by setting dsn to the directory where the shape file lives
# and layer to the name of the shape file without the file extension (.shp)
DataBase = read_sf(dsn = "/Users/vanessazobell/Documents/SIO/Outreach/mpa_inventory_2014_public_shp", layer = "mpa_inventory_2014_public_shp")

```

For this example, let's look at the Marine Protected areas off the Coast of California. When looking at our database, we see that there is a column titled "State", and each row contains the state that the Marine Protected Area is in. We will filter our database to pull out all of the Marine Protected Areas that are in the "State" of "California" using the following code chunk. We will call this new database "California". 

```{r}
# install and load the "dplyr" package to help us filter our data
library(dplyr)

California = filter(DataBase, State == "California")

```

There are 185 Marine Protected Areas in our California database! Let's make a map to see all of the boundaries of the Marine Protected Areas. The "geometry" column has the information of the boundaries. The geometry will give us the latitude and longitude, which we will use to plot the boundary of each Marine Protected Area on our map. 

To set up the map, we will first map a blank map of the state of California. We will use built-in "leaflet" library to make our map. Let's set it up so that we can see the ocean topography using the Esri Ocean Basemap. We'll save our map as "CaliforniaMap". To print the CaliforniaMap, we'll type in CaliforniaMap. 


```{r}
# install and load the leaflet package so that we can make our map
library(leaflet)

CaliforniaMap = leaflet() %>% # start an empty map
   addProviderTiles("Esri.OceanBasemap") %>% # add the ocean basemap 
   fitBounds( -124, 41, -116, 32) # zoom in to the california area

CaliforniaMap # print the map

```
Nice! Now let's add the boundaries of all of the Marine Protected Areas that are on the California Coast. We will loop through each individual Marine Protected area, and plot the latitudes and longitudes on our California map, that way, we can see ALL of the Marine Protected Areas on our map together. We will use "addPolygons" to add each Marine Protected Area's boundary. You can pick the color that you would like to make the boundary in the "color" section of "addPolygons". For this example, I made the color red, but you can change it to whatever color you would like!

```{r}

# loop through each MPA and plot the boundaries on our California Map
for(i in 1:length(California$Site_Name)) {
Geo = as.data.frame(California[[25]][[i]][[1]][[1]]) #the geometry is in the 25th column
Longitude = Geo$V1 #Longitude is saved as Variable 1
Latitude = Geo$V2 #Latitude is saved as Variable 2
CaliforniaMap = CaliforniaMap  %>% 
       addPolygons(lng=Longitude,lat=Latitude, 
                   color = "red", # I wanted to make the MPAs red, but you can put any colors you want!
                   opacity = .5, 
                   fillOpacity = 0.2)
}

CaliforniaMap # print the map
```
```

```
Wow, California has a LOT of Marine Protected Areas! Let's analyze some data from Marine Protected Areas in California to see exactly how they have helped in the protection of marine organisms! We will need to connect to an online databases to access information about marine organisms. Additionally, some packages in R will need to be installed so that we can see exactly what is going in with our data. Run the code chunk below to install the packages necessary for this activity. 

```{r}
#load libraries
install.packages("robis")
library(robis)
library('ggplot2')
install.packages("rnaturalearth")
library("rnaturalearth")
install.packages("rnaturalearthdata")
library("rnaturalearthdata")
library(roperators)
install.packages("roperators")

library(magrittr) 
install.packages("vegan")
library(vegan)

install.packages("measurements")
library(measurements)

installed <- rownames(installed.packages())
if ( !("robis" %in% installed) ){
   if ( !("remotes" %in% installed) )install.packages("remotes")
   remotes::install_github("iobis/robis")
}
library("robis")

install.packages("wellknown")
install.packages("V8")
library("V8")
library("wellknown")

```
```


```
Let's look into a specific Marine Protected Area now. 


```{r}

Scripps = filter(California, Site_Name == "Scripps Coastal Reserve")

ScrippsGeo = as.data.frame(California[[25]][[1]][[1]][[1]]) #the geometry is in the 25th column
ScrippsLongitude = Geo$V1 #Longitude is saved as Variable 1
ScrippsLatitude = Geo$V2 #Latitude is saved as Variable 2


POLYGON = list(Polygon = list(c(Longitude, Latitude)))


WKPOLYGON = geojson2wkt(POLYGON$Polygon)

taxa <- checklist(geometry = "POLYGON ((2.3 51.8, 2.3 51.6, 2.6 51.6, 2.6 51.8, 2.3 51.8))")
taxa <- checklist(geometry = POLYGON)


mp <- list(MultiPoint = matrix(c(100, 101, 3.14, 3.101, 2.1, 2.18)))



poly <- list(Polygon = list(
matrix(c(100.001, 101.1, 101.001, 100.001, 0.001, 0.001, 1.001, 0.001), ncol = 2)))
geojson2wkt(poly)
geojson2wkt(poly, fmt=6)



SpeciesOccurence <- occurrence(geometry = poly)
taxa <- checklist(geometry = poly)





x = data.frame(lat = c("32°49.573", "32°47.945",  "32°47.945", "32°49.573", "32°49.573"),
               lon = c("-117°19.000", "-117°20.528", "-117°20.068", "-117°19.000", "-117°19.000"))

x$lat = gsub('°', ' ', x$lat)
x$lon = gsub('°', ' ', x$lon)
#convert from decimalminute to decimal degree
x$latdec = measurements::conv_unit(x$lat, from = 'deg_dec_min', to = 'dec_deg')
x$londec = measurements::conv_unit(x$lon, from = 'deg_dec_min', to = 'dec_deg')
```

```{r}




taxa <- checklist(geometry = "POLYGON ((2.3 51.8, 2.3 51.6, 2.6 51.6, 2.6 51.8, 2.3 51.8))")
taxa <- checklist(geometry = POLYGON)
taxa = geometry(occurence())

latlon = rbind(Longitude, Latitude)

# <- occurrence(geometry = "POLYGON ((-117.32 32.83, -117.34 32.83, -117.33 32.80, -117.32 32.80, -117.32 32.83)) ")

animals = filter(SpeciesOccurence, kingdom == "Animalia") #filtering the dataframe to pull out the animals
sort(table(animals$scientificName), decreasing = TRUE)[1:10] #finding the 10 animals that occur most often in the dataframe
kelpBass = filter(SpeciesOccurence, scientificName == "Paralabrax clathratus") #since kelpbass is the most commonly occuring animal, pull out info on the kelp bass

ggplot(kelpBass, aes(x = date_year)) + 
  geom_histogram(color = "darkblue", fill = "lightblue") + 
  labs(title = "Kelp Bass in Anacapa State Marine Reserve", x = "Year", y = "# of Kelp Bass") # make a histogram showing the kelp bass count from 2006 through 2020


```


